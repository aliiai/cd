# ุฃูุฑ ุงุฎุชุจุงุฑ ุชูููุฏ ุฑุงุจุท ุงูุฏูุน - PayMob Test Command

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ุฃูุฑ Artisan ูุงุฎุชุจุงุฑ ุชูููุฏ ุฑุงุจุท ุงูุฏูุน ุนุจุฑ PayMob. ูุฐุง ุงูุฃูุฑ ูุณุงุนุฏู ูู:

- โ ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช PayMob
- โ ุงุฎุชุจุงุฑ ุงููุตุงุฏูุฉ ูุน PayMob API
- โ ุชูููุฏ ุฑุงุจุท ุฏูุน ุชุฌุฑูุจู
- โ ุนุฑุถ ูุนูููุงุช ููุตูุฉ ุนู ุงูุนูููุฉ

## ๐ ุงูุงุณุชุฎุฏุงู

### ุงูุฃูุฑ ุงูุฃุณุงุณู

```bash
php artisan payment:test-link
```

ูุฐุง ุณููุดุฆ ุฑุงุจุท ุฏูุน ุจููู ุงูุชุฑุงุถูุฉ:
- ุงููุจูุบ: 50 ุฑ.ุณ
- ุงูุงุณู: ูุณุชุฎุฏู ุชุฌุฑูุจู
- ุงูุจุฑูุฏ: test@example.com
- ุงููุงุชู: +966500000000

### ูุน ุฎูุงุฑุงุช ูุฎุตุตุฉ

```bash
php artisan payment:test-link --amount=100 --name="ุฃุญูุฏ ูุญูุฏ" --email="ahmed@example.com" --phone="966501234567"
```

### ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ

| ุงูุฎูุงุฑ | ุงููุตู | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|--------|-------|-------------------|
| `--amount` | ุงููุจูุบ ุจุงูุฑูุงู ุงูุณุนูุฏู | 50 |
| `--name` | ุงุณู ุงููุฏููู | ูุณุชุฎุฏู ุชุฌุฑูุจู |
| `--email` | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู | test@example.com |
| `--phone` | ุฑูู ุงููุงุชู | +966500000000 |

### ุฃูุซูุฉ

#### ูุซุงู 1: ุงุฎุชุจุงุฑ ุจุณูุท
```bash
php artisan payment:test-link
```

#### ูุซุงู 2: ุงุฎุชุจุงุฑ ุจูุจูุบ ูุญุฏุฏ
```bash
php artisan payment:test-link --amount=250
```

#### ูุซุงู 3: ุงุฎุชุจุงุฑ ูุงูู
```bash
php artisan payment:test-link \
  --amount=100 \
  --name="ูุญูุฏ ุฃุญูุฏ" \
  --email="mohammed@example.com" \
  --phone="966501234567"
```

## ๐ ุงููุฎุฑุฌุงุช

ุงูุฃูุฑ ูุนุฑุถ:

1. **ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ**: ุงููุจูุบุ ุงูุงุณูุ ุงูุจุฑูุฏุ ุงููุงุชู
2. **ุญุงูุฉ ุงูุฅุนุฏุงุฏุงุช**: ุงูุชุญูู ูู ูุฌูุฏ ุฌููุน ุฅุนุฏุงุฏุงุช PayMob
3. **ูุชูุฌุฉ ุงููุตุงุฏูุฉ**: Token length ู Profile ID
4. **ูุนูููุงุช ุฑุงุจุท ุงูุฏูุน**: ุงูุฑุงุจุท ุงููุงูู ู PayMob Order ID

### ูุซุงู ุนูู ุงููุฎุฑุฌุงุช

```
๐ ุจุฏุก ุงุฎุชุจุงุฑ ุชูููุฏ ุฑุงุจุท ุงูุฏูุน...

๐ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ:
+-------------------+-------------------+
| ุงููุนุงูู           | ุงููููุฉ            |
+-------------------+-------------------+
| ุงููุจูุบ            | 50 ุฑ.ุณ            |
| ุงูุงุณู             | ุฒูุงุฏ ูุญูุฏ         |
| ุงูุจุฑูุฏ ุงูุฅููุชุฑููู | test@example.com  |
| ุฑูู ุงููุงุชู        | 966537302222      |
+-------------------+-------------------+

๐ ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช PayMob...
+----------------+--------------------+
| ุงูุฅุนุฏุงุฏ        | ุงูุญุงูุฉ             |
+----------------+--------------------+
| API Key        | โ ููุฌูุฏ (264 ุญุฑู) |
| Integration ID | โ ููุฌูุฏ           |
| iFrame ID      | โ ููุฌูุฏ           |
| Merchant ID    | โ ููุฌูุฏ           |
+----------------+--------------------+

๐ ุงุฎุชุจุงุฑ ุงููุตุงุฏูุฉ ูุน PayMob...
โ ุชูุช ุงููุตุงุฏูุฉ ุจูุฌุงุญ!
   Token Length: 400 ุญุฑู
   Profile ID: 5434

๐ ุชูููุฏ ุฑุงุจุท ุงูุฏูุน...
โ ุชู ุชูููุฏ ุฑุงุจุท ุงูุฏูุน ุจูุฌุงุญ!

๐ ูุนูููุงุช ุฑุงุจุท ุงูุฏูุน:
+------------------+--------------------------------------------------+
| ุงููุนูููุฉ         | ุงููููุฉ                                          |
+------------------+--------------------------------------------------+
| ุฑุงุจุท ุงูุฏูุน       | https://ksa.paymob.com/api/acceptance/iframes/... |
| PayMob Order ID  | 1696846                                         |
+------------------+--------------------------------------------------+
```

## โ ุงูุชุญูู ูู ุงููุฌุงุญ

ุฅุฐุง ูุฌุญ ุงูุงุฎุชุจุงุฑุ ุณุชุฑู:

- โ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ููุฌูุฏุฉ
- โ ุชูุช ุงููุตุงุฏูุฉ ุจูุฌุงุญ
- โ ุชู ุชูููุฏ ุฑุงุจุท ุงูุฏูุน ุจูุฌุงุญ
- โ ุฑุงุจุท ุงูุฏูุน ุตุงูุญ ููููู ูุชุญู

## โ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "ุฅุนุฏุงุฏุงุช PayMob ุบูุฑ ููุชููุฉ"

**ุงูุญู:**
1. ุชุญูู ูู ููู `.env`
2. ุชุฃูุฏ ูู ูุฌูุฏ ุฌููุน ุงูุฅุนุฏุงุฏุงุช:
   - `PAYMOB_API_KEY`
   - `PAYMOB_INTEGRATION_ID`
   - `PAYMOB_IFRAME_ID`
   - `PAYMOB_MERCHANT_ID`

### ุงููุดููุฉ: "ูุดู ุงููุตุงุฏูุฉ ูุน PayMob"

**ุงูุญู:**
1. ุชุญูู ูู ุตุญุฉ API Key
2. ุชุญูู ูู Base URL: `https://ksa.paymob.com/api`
3. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
4. ุฑุงุฌุน ุงูุณุฌูุงุช ูู `storage/logs/laravel.log`

### ุงููุดููุฉ: "ูุดู ุชูููุฏ ุฑุงุจุท ุงูุฏูุน"

**ุงูุญู:**
1. ุชุญูู ูู ุงูุณุฌูุงุช ูู `storage/logs/laravel.log`
2. ุชุญูู ูู Integration ID ู iFrame ID
3. ุชุฃูุฏ ูู ุฃู ุงููุจูุบ ุฃูุจุฑ ูู 0
4. ุชุญูู ูู ุจูุงูุงุช ุงูููุชุฑุฉ (billing_data)

## ๐ง ุงูุฅุตูุงุญุงุช ุงููููุฐุฉ

### 1. ุฅุตูุงุญ ูุดููุฉ `last_name`

ุชู ุฅุตูุงุญ ูุดููุฉ `last_name` ุงูุชู ูุงูุช ุชุณุจุจ ุฎุทุฃ 400:

**ูุจู:**
```php
'last_name' => $billingData['last_name'] ?? 'NA',
```

**ุจุนุฏ:**
```php
// ุชูุณูู ุงูุงุณู ุฅุฐุง ูู ูุชู ุชูููุฑ last_name
$firstName = $billingData['first_name'] ?? 'Customer';
$lastName = $billingData['last_name'] ?? '';

// ุฅุฐุง ูู ููู ููุงู last_nameุ ูู ุจุชูุณูู first_name
if (empty($lastName) && !empty($firstName)) {
    $nameParts = explode(' ', $firstName, 2);
    $firstName = $nameParts[0] ?? 'Customer';
    $lastName = $nameParts[1] ?? 'Name';
}

// ุฅุฐุง ูุงู last_name ูุง ูุฒุงู ูุงุฑุบุงูุ ุงุณุชุฎุฏู ูููุฉ ุงูุชุฑุงุถูุฉ
if (empty($lastName)) {
    $lastName = 'Name';
}
```

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ูุง ูุชู ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุนูุฏ ุงุณุชุฎุฏุงู ุงูุฃูุฑ ููุงุฎุชุจุงุฑุ ูุง ูุชู ุญูุธ PaymentTransaction ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (debtorId = null)

2. **ุฑุงุจุท ุงูุฏูุน ุตุงูุญ ููุฏุฉ ุณุงุนุฉ**: Payment key ุตุงูุญ ููุฏุฉ 3600 ุซุงููุฉ (ุณุงุนุฉ ูุงุญุฏุฉ)

3. **ููุงุฎุชุจุงุฑ ููุท**: ูุฐุง ุงูุฃูุฑ ููุงุฎุชุจุงุฑ ููุทุ ูุง ูุณุชุฎุฏู ูู production

4. **ุชุญูู ูู ุงูุณุฌูุงุช**: ูู ุญุงูุฉ ูุฌูุฏ ูุดุงููุ ุฑุงุฌุน `storage/logs/laravel.log`

## ๐ฏ ุงูุงุณุชุฎุฏุงูุงุช

### 1. ุงุฎุชุจุงุฑ ุจุนุฏ ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช ุฌุฏูุฏุฉ
```bash
php artisan payment:test-link
```

### 2. ุงุฎุชุจุงุฑ ุจูุจูุบ ูุญุฏุฏ
```bash
php artisan payment:test-link --amount=1000
```

### 3. ุงุฎุชุจุงุฑ ูุน ุจูุงูุงุช ุญููููุฉ
```bash
php artisan payment:test-link \
  --amount=500 \
  --name="ุฃุญูุฏ ูุญูุฏ ุนูู" \
  --email="ahmed@example.com" \
  --phone="966501234567"
```

## ๐ ุงููููุงุช ุฐุงุช ุงูุตูุฉ

- `app/Console/Commands/TestPaymentLinkCommand.php` - ุงูุฃูุฑ
- `app/Services/PaymobService.php` - ุฎุฏูุฉ PayMob
- `config/services.php` - ุฅุนุฏุงุฏุงุช PayMob
- `storage/logs/laravel.log` - ุณุฌูุงุช ุงููุธุงู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-12-22  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู

